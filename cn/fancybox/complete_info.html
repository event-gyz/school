<!-- 【fancybox】完整信息 -->
<?php
if(isset($member_uid) && $member_uid > 0) {
    $sql = "select * from member where uid='$member_uid'";
    $result = M()->find($sql);
    if($result!=null) {
        $phone = $result['cellphone'];
    }else{
        $phone = '';
    }
}
?>
<section id="fy-complete-info" class="mbbox">
    <section class="fy-hd"><h2 class="title">完整信息</h2></section>
    <section class="fy-bd clearfix">
        <section class="fy-cont clearfix">
            <form id="complete_info_form">
                <section class="lbox">
                    <p>注：为保证服务质量，请填写正确完整信息，我们将提供您最精准贴心的育儿服务</p>
                    <section class="formbox">
                        <?php if($phone == ''){?>
                        <div class="fbar clearfix isbind_mobile">
                            <label><i>手机号</i><input name="mobile" id="mobile" type="tel" placeholder="11位手机号码" class="tf"></label>
                            <p class="bind_courtesy">
                                <a href="#fy-mobile-bind">现在绑定立享好礼</a>
                            </p>
                        </div>
                        <?php }?>
                        <div class="fbar clearfix">
                            <label><i>宝宝昵称</i><input name="reg_name" id="reg_name" type="text" class="tf"></label>
                            <div id="errorbar_reg_name" class="errorbar">请输入6-20位中文或英文字符</div>
                        </div>
                        <div class="fbar clearfix">
                            <label><i>宝宝性别</i>
                                <div class="ralist ralist02">
                                    <ul class="clearfix">
                                        <li><label><input type="radio" name="fbar_sex" value="0" checked><b class="genner">男</b></label></li>
                                        <li><label><input type="radio" name="fbar_sex" value="1"><b class="genner">女</b></label></li>
                                    </ul>
                                </div>
                                <!--<s class="genner selected">男</s>-->
                                <!--<s class="genner">女</s>-->
                            </label>
                        </div>
                        <div class="fbar clearfix">
                            <label><i>宝宝生日</i>
                                <input id="reg_date" name="reg_date" type="date" class="tf">
                            </label>
                            <div id="errorbar_reg_date" class="errorbar">请选择宝宝生日</div>
                        </div>
                        <div class="fbar clearfix">
                            <label>
                                <i>所在城市</i>
                                <div class="search-citys">
                                    <input class="text tf" type="text" readonly placeholder="选择城市" id="city_name" name="addr" data-key="5-95-1417" unselectable="on" onfocus="this.blur()">
                                </div>
                            </label>
                            <div id="errorbar_address" class="errorbar">请选择所在城市</div>
                        </div>
                    </section>
                </section>
                <section class="rbox">
                    <input type="submit" class="btn_submit05" value="">
                </section>
            </form>
        </section>
    </section>
</section>
<script>
    // var cityChange= eval(cityChange);
    $(function(){
        $('.bind_courtesy a').click(function(){
            $.fancybox({
                href: "#fy-mobile-bind"
            });
        })
        /**
         * 通过数组id获取地址列表数组
         *
         * @param {Number} id
         * @return {Array} 
         */ 
        function getAddrsArrayById(id) {
            var results = [];
            if (addr_arr[id] != undefined)
                addr_arr[id].forEach(function(subArr) {
                    results.push({
                        key: subArr[0],
                        val: subArr[1]
                    });
                });
            else {
                return;
            }
            return results;
        }
        /**
         * 通过开始的key获取开始时应该选中开始数组中哪个元素
         *
         * @param {Array} StartArr
         * @param {Number|String} key
         * @return {Number} 
         */         
        function getStartIndexByKeyFromStartArr(startArr, key) {
            var result = 0;
            if (startArr != undefined)
                startArr.forEach(function(obj, index) {
                    if (obj.key == key) {
                        result = index;
                        return false;
                    }
                });
            return result;
        }

        //bind the click event for 'input' element
        $("#city_name").click(function() {
            var PROVINCES = [],
                startCities = [];
                // ,
                // startDists = [];
            //Province data，shall never change.
            addr_arr[0].forEach(function(prov) {
                PROVINCES.push({
                    key: prov[0],
                    val: prov[1]
                });
            });
            //init other data.
            var $input = $(this),
                dataKey = $input.attr("data-key"),
                provKey = 1, //default province 北京
                cityKey = 36, //default city 北京
                // distKey = 37, //default district 北京东城区
                // distStartIndex = 0, //default 0
                cityStartIndex = 0, //default 0
                provStartIndex = 0; //default 0

            if (dataKey != "" && dataKey != undefined) {
                var sArr = dataKey.split("-");
                if (sArr.length == 3) {
                    provKey = sArr[0];
                    cityKey = sArr[1];
                    // distKey = sArr[2];

                } else if (sArr.length == 2) { //such as 台湾，香港 and the like.
                    provKey = sArr[0];
                    cityKey = sArr[1];
                }
                startCities = getAddrsArrayById(provKey);
                // startDists = getAddrsArrayById(cityKey);
                provStartIndex = getStartIndexByKeyFromStartArr(PROVINCES, provKey);
                cityStartIndex = getStartIndexByKeyFromStartArr(startCities, cityKey);
                // distStartIndex = getStartIndexByKeyFromStartArr(startDists, distKey);
            }
            var navArr = [{//3 scrollers, and the title and id will be as follows:
                title: "省",
                id: "scs_items_prov"
            }, {
                title: "市",
                id: "scs_items_city"
            }
            // , {
            //     title: "区",
            //     id: "scs_items_dist"
            // }
            ];
            SCS.init({
                navArr: navArr,
                onOk: function(selectedKey, selectedValue) {
                    $input.val(selectedValue).attr("data-key", selectedKey);
                }
            });
            // var distScroller = new SCS.scrollCascadeSelect({
            //     el: "#" + navArr[2].id,
            //     dataArr: startDists,
            //     startIndex: distStartIndex
            // });
            var cityScroller = new SCS.scrollCascadeSelect({
                el: "#" + navArr[1].id,
                dataArr: startCities,
                startIndex: cityStartIndex,
                // onChange: function(selectedItem, selectedIndex) {
                //     distScroller.render(getAddrsArrayById(selectedItem.key), 0); //re-render distScroller when cityScroller change
                // }
            });
            var provScroller = new SCS.scrollCascadeSelect({
                el: "#" + navArr[0].id,
                dataArr: PROVINCES,
                startIndex: provStartIndex,
                onChange: function(selectedItem, selectedIndex) { //re-render both cityScroller and distScroller when provScroller change
                    cityScroller.render(getAddrsArrayById(selectedItem.key), 0);
                    // distScroller.render(getAddrsArrayById(cityScroller.getSelectedItem().key), 0);
                }
            });
        });
    })
</script>
<!--//【fancybox】完整信息//